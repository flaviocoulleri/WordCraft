<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Juego de completar palabras</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
        background-color: #f4f4f4;
      }
      #game-container {
        display: none;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        width: 50%;
        margin: auto;
        position: relative;
      }
      .stats {
        text-align: center;
        margin-bottom: 20px;
      }
      .blank {
        display: inline-block;
        min-width: 80px;
        padding: 5px;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        color: black;
        background-color: #e0e0e0;
        border-radius: 5px;
        transition: all 0.3s ease-in-out;
      }
      #word-input {
        padding: 10px;
        font-size: 1.2em;
        border-radius: 5px;
        border: 2px solid #007bff;
        transition: 0.3s;
      }
      .button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 1.2em;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .button:hover {
        background-color: #0056b3;
      }
      .correct {
        color: green;
        font-weight: bold;
      }
      .incorrect {
        color: red;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Juego de completar palabras</h1>
    <textarea
      id="input-text"
      placeholder="Escribe un texto aquí..."
      style="
        width: 80%;
        height: 100px;
        padding: 10px;
        border-radius: 10px;
        border: 2px solid #007bff;
      "
    ></textarea>
    <br />
    <label for="word-count">Palabras a adivinar:</label>
    <input type="number" id="word-count" min="1" style="width: 60px" />
    <br />
    <button class="button" onclick="startGame()">Continuar</button>
    <div class="stats">
      <p>Restantes: <span id="remaining-count"></span></p>
      <p>Aciertos: <span id="correct-count">0</span></p>
      <p>Errores: <span id="wrong-count">0</span></p>
    </div>
    <div id="game-container">
      <p id="sentence"></p>
      <input
        type="text"
        id="word-input"
        placeholder="Escribe la palabra..."
        onkeypress="handleKeyPress(event)"
      />
      <button class="button" onclick="checkWord()">Comprobar</button>
      <p id="feedback"></p>
      <button
        id="restart-button"
        class="button"
        style="display: none"
        onclick="restartGame()"
      >
        Reiniciar
      </button>
      <p id="final-score" style="display: none"></p>
    </div>

    <script>
      let words = [];
      let currentWord = "";
      let correctCount = 0;
      let wrongCount = 0;
      let totalWords = 0;
      let sentence = "";

      function normalizeText(text) {
        return text
          .toLowerCase()
          .normalize("NFD")
          .replace(/[̀-ͯ]/g, "")
          .replace(/[.,!?;:]/g, "")
          .trim();
      }

      function startGame() {
        let text = document.getElementById("input-text").value;
        let wordCount =
          parseInt(document.getElementById("word-count").value) || 1;
        words = text.split(/\s+/).filter((word) => word.trim().length > 0);
        totalWords = Math.min(wordCount, words.length);
        if (words.length < 2) {
          alert("Introduce un texto con más palabras.");
          return;
        }
        sentence = text;
        document.getElementById("input-text").style.display = "none";
        document.getElementById("word-count").style.display = "none";
        document.querySelector("button").style.display = "none";
        document.getElementById("game-container").style.display = "block";
        document.getElementById("remaining-count").innerText = totalWords;
        nextWord();
      }

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          checkWord();
        }
      }

      function checkWord() {
        let input = normalizeText(document.getElementById("word-input").value);
        let expected = normalizeText(currentWord);
        if (input === expected) {
          correctCount++;
          document.getElementById("correct-count").innerText = correctCount;
        } else {
          wrongCount++;
          document.getElementById("wrong-count").innerText = wrongCount;
        }
        nextWord();
      }

      function nextWord() {
        if (totalWords === 0) {
          document.getElementById("sentence").innerText = "¡Juego terminado!";
          document.getElementById("word-input").style.display = "none";
          document.querySelector("button").style.display = "none";
          document.getElementById("restart-button").style.display =
            "inline-block";
          let total = correctCount + wrongCount;
          let accuracy = ((correctCount / total) * 100).toFixed(2);
          document.getElementById(
            "final-score"
          ).innerText = `Promedio de aciertos: ${accuracy}%`;
          document.getElementById("final-score").style.display = "block";
          return;
        }
        let index = Math.floor(Math.random() * words.length);
        currentWord = words[index].replace(/[.,!?;:]/g, "");
        words.splice(index, 1);
        totalWords--;
        document.getElementById("remaining-count").innerText = totalWords;
        document.getElementById("word-input").value = "";
        document.getElementById("feedback").innerText = "";
        document.getElementById("sentence").innerHTML = sentence.replace(
          currentWord,
          "<span class='blank'>_____</span>"
        );
      }
    </script>
  </body>
</html>
